### **1. Краткое описание проекта**

**1.1. Ф.И.О. разработчиков.**  
Эйзерман Александр Николаевич

**1.2. Группа.**  
Д-Э 311

**1.3. Тема проекта.**  
Разработка высоконагруженного веб-сервиса для сокращения URL-адресов.

**1.4. Цель проекта.**  
Создать отказоустойчивый, масштабируемый сервис сокращения ссылок, обеспечивающий высокую скорость создания коротких ссылок и мгновенное перенаправление пользователей.

**1.5. Задачи проекта.**
1.  Проектирование и реализация RESTful API для основных операций: создание короткой ссылки и редирект по коду.
2.  Проектирование и развертывание базы данных MySql для постоянного хранения соответствий.
3.  Внедрение кэширующего слоя (Memcached) для ускорения операций чтения (редиректов).
4.  Проектирование архитектуры с балансировщиком нагрузки (Nginx) для горизонтального масштабирования сервиса.
5.  Документирование процесса проектирования (ментальные карты, IDEF0, DFD, BPMN, UML, ER).
6.  Контейнеризация сервисов с использованием Docker и Docker Compose.

**1.6. Аннотация.**  
Проект представляет собой полный цикл разработки современного облачного сервиса. Система позволяет пользователям преобразовывать длинные URL в короткие, удобные для использования в соцсетях, мессенджерах и QR-кодах. Ключевыми особенностями являются высокая доступность и производительность, достигнутые за счет разделения на микросервисы, использования реляционной базы данных для надежности и кэша для скорости. Все компоненты развертываются в контейнерах, что обеспечивает легкую масштабируемость и переносимость.
### **2. Документация**

#### **2.1. Подробное описание проекта.**

Проект представляет собой распределенную систему, состоящую из нескольких логических компонентов:
*   **Веб-приложение (API):** Ядро системы, написанное на Go. Отвечает за бизнес-логику: прием запросов, генерацию кода, взаимодействие с БД и кэшем.
*   **База данных (MySql):** Хранит основную информацию: уникальный код, оригинальный URL, дату создания, счетчик переходов.
*   **Кэш (Memcached):** Служит для хранения пар «код-URL» с высокой скоростью доступа. Значительно снижает нагрузку на БД при частых редиректах.
*   **Балансировщик нагрузки (Nginx):** Распределяет входящие HTTP-запросы между несколькими экземплярами веб-приложения для обеспечения отказоустойчивости и горизонтального масштабирования.
*   **Клиентское приложение:** Простой веб-интерфейс на HTML/JS для взаимодействия пользователя с API.

Сценарий работы: Пользователь через интерфейс отправляет длинный URL. Запрос через Nginx попадает на один из экземпляров API. API генерирует короткий код (например, `aBc4d`), сохраняет пару в БД, помещает ее в Redis и возвращает короткую ссылку. При переходе по короткой ссылке API сначала проверяет кэш. При попадании редирект выполняется мгновенно. При промахе данные запрашиваются из БД, заносятся в кэш и выполняется редирект. При отсутствии возвращается ошибка Not Found (404)

#### **2.2. Ментальная карта**
```mermaid
mindmap
  root((Сервис сокращения ссылок))
    Основные функции
      Создание короткой ссылки
        Валидация URL
        Генерация уникального кода
        Сохранение в БД и кэш
      Редирект по коду
        Поиск в кэше (Memcached)
        Поиск в БД (MySql)
        Отправка HTTP 301
    
    Архитектура
      Веб-сервер (Nginx)
        Балансировка нагрузки
        Раздача статики (Frontend)
      Бэкенд-сервис (Go)
        Микросервис API
        Контейнеризация (Docker)
      Хранилища
        Основная БД (MySql)
          Таблица url_mappings
        Кэш (Memcached)
```

#### **2.3. Модель в нотации IDEF0**

```mermaid
flowchart TD
    C1[Управление Controls:<br/>- Бизнес-требования<br/>- Технические спецификации<br/>- Конфигурационные файлы<br/>- Политика генерации кодов]
    
    I1[Вход Inputs:<br/>- Длинный URL<br/>- Короткий код]
    
    A0[Процесс A0:<br/>Создать и<br/>перенаправить<br/>короткую ссылку]
    
    O1[Выход Outputs:<br/>- Короткий URL<br/>- HTTP-редирект 301<br/>]
    
    M1[Механизмы Mechanisms:<br/>- Веб-API Go<br/>- БД MySql<br/>- Кэш Memcached<br/>- Балансировщик Nginx]
    
    C1 --> A0
    I1 --> A0
    A0 --> O1
    M1 --> A0
```

**A0: "Создать и перенаправить короткую ссылку"**
*   **Вход (I):** Оригинальный URL от пользователя; Запрос на редирект с коротким кодом.
*   **Выход (O):** Короткий URL; HTTP-редирект на оригинальный URL; Статистика.
*   **Управление (C):** Бизнес-правила (формат URL, длина кода), конфигурационные файлы.
*   **Механизмы (M):** Веб-сервер (FastAPI), СУБД PostgreSQL, Кэш Redis.


#### **2.4. Фрагменты модели в нотации DFD**

**DFD Уровень 0 (Контекстная диаграмма):**
```mermaid
flowchart TD
    U[Пользователь] -->|URL, Код| S[Система сокращения ссылок]
    S -->|Короткий URL, Редирект| U
```

**DFD Уровень 1 (Декомпозиция системы):**
```mermaid
flowchart TD
    U[Пользователь] --> P1[Принять запрос]
    P1 -->|"Запрос: shorten"| P2[Обработать создание]
    P1 -->|"Запрос: redirect"| P3[Обработать редирект]
    
    P2 -->|Сгенерировать код| P4[Записать в хранилища]
    P4 -->|"Код, URL"| D1[(База данных)]
    P4 -->|"Код, URL"| D2[("Кэш (Redis)")]
    P4 --> U1{Создать ответ}
    U1 -->|Короткая ссылка| U

    P3 -->|Поиск по коду| D2
    D2 -->|Найдено| U2{Отправить редирект}
    D2 -->|Не найдено| D1
    D1 -->|Найдено| P5[Обновить кэш]
    P5 --> D2
    P5 --> U2
    U2 -->|HTTP 301| U
```

DFD показывает потоки данных в системе. На уровне 1 видно разделение процессов на создание ссылки и редирект. Ключевой момент — процесс редиректа (`P3`) сначала обращается к кэшу (`D2`), и только в случае промаха идет в основную БД (`D1`), после чего обновляет кэш (`P5`). Это иллюстрирует стратегию ускорения чтения
#### **2.5. Модель в нотации BPMN**

```mermaid
flowchart TD
    Start([Start]) --> Receive[Получить HTTP-запрос]
    Receive --> Decision{Тип запроса?}

    Decision -->|POST /shorten| ValidateURL[Валидировать URL]
    ValidateURL --> GenCode[Сгенерировать уникальный код]
    GenCode --> SaveDB[Сохранить код:URL в БД]
    SaveDB --> SaveCache[Сохранить код:URL в кэш]
    SaveCache --> ReturnShort[Вернуть короткий URL]
    ReturnShort --> End1([End])

    Decision -->|GET /code| LookupCache[Поиск URL в кэше по коду]
    LookupCache --> CacheDecision{Найдено?}
    CacheDecision -->|Да| Redirect[Вернуть HTTP 301 редирект]
    
    CacheDecision -->|Нет| LookupDB[Поиск URL в БД по коду]
    LookupDB --> DBDecision{Найдено?}
    DBDecision -->|Нет| Return404[Вернуть 404 ошибку]
    Return404 --> End3([End])
    
    DBDecision -->|Да| UpdateCache[Сохранить пару в кэш]
    UpdateCache --> Redirect[Вернуть HTTP 301 редирект]
    Redirect --> End2([End])
```

#### **2.6. Модели в нотации UML.**

**2.6.1. Диаграмма классов (Структурный тип)**
```mermaid
classDiagram
    class URLMapping {
        -id: UUID
        -short_code: String
        -original_url: String
        -created_at: DateTime
        -clicks: Integer
        +__init__(original_url: String)
        +generate_short_code(): String
    }

    class URLService {
        -db_session
        -cache_client
        +create_short_url(url: String) URLMapping
        +get_original_url(code: String) String
        +increment_clicks(code: String) void
    }

    class URLController {
        -url_service: URLService
        +shorten(request: Request) JSON
        +redirect(code: String) RedirectResponse
    }

    URLController --> URLService : uses
    URLService --> URLMapping : creates/manages
```
`URLMapping` — модель данных. `URLService` — класс, инкапсулирующий бизнес-логику (работа с БД, кэшем). `URLController` — обработчик HTTP-запросов

**2.6.2. Диаграмма последовательности (Поведенческий тип)**
```mermaid
sequenceDiagram
    participant U as User
    participant LB as Load Balancer (Nginx)
    participant API as API Instance (Go)
    participant Cache as Memcached
    participant DB as MySql

    U->>LB: POST /shorten (long_url)
    LB->>API: Forward request
    API->>API: Validate & Generate Code
    API->>DB: INSERT (code, url)
    DB-->>API: OK
    API->>Cache: SET code "url"
    Cache-->>API: OK
    API-->>LB: short_url (JSON)
    LB-->>U: short_url

    U->>LB: GET /{code}
    LB->>API: Forward request
    API->>Cache: GET code
    alt Cache HIT
        Cache-->>API: original_url
        API-->>LB: HTTP 301 (Location)
        LB-->>U: Redirect
    else Cache MISS
        Cache-->>API: null
        API->>DB: SELECT url WHERE code=...
        DB-->>API: original_url
        API->>Cache: SET code "url"
        API-->>LB: HTTP 301 (Location)
        LB-->>U: Redirect
    end
```
**2.6.3. Диаграмма развертывания (Структурный тип)**
```mermaid
flowchart
    subgraph "Внешний мир"
        User[Пользователь / Браузер]
    end

    subgraph "Сервер / Докер-хост"
        LB[Load Balancer<br>Nginx Container]
        
        subgraph "Бэкенд-кластер"
            API1[API Container 1<br>]
            API2[API Container 2<br>]
        end

        subgraph "Слой данных"
            Cache[(Кэш<br>MemcachedContainer)]
            DB[(База данных<br>MySql Container)]
        end
    end

    User -->|HTTP/HTTPS| LB
    LB --> API1 & API2
    API1 & API2 --> Cache
    API1 & API2 --> DB
```
